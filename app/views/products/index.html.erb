<h1>Products</h1>

<h2 class="my-4">Search Products</h2>

<%= form_with url: products_path, method: :get, local: true, class: "mb-4" do %>
  <div style="display: flex; gap: 10px;">
    <!-- Keyword Search -->
    <%= text_field_tag :keyword, params[:keyword],
        placeholder: "Search by name or description...",
        class: "form-control" %>

    <!-- Category Dropdown -->
    <%= select_tag :search_category_id,
        options_for_select([["All Categories", ""]] +
                            @categories.map { |c| [c.name, c.id] },
                            params[:search_category_id]),
        class: "form-select" %>

    <%= submit_tag "Search", class: "btn btn-primary" %>
  </div>
<% end %>

<!-- Category Filter -->
<%= form_with url: products_path, method: :get, local: true do %>
  <div style="margin-bottom: 20px;">
    <%= label_tag :category_id, "Filter by Category:" %>

    <%= select_tag :category_id,
        options_from_collection_for_select(@categories, :id, :name, params[:category_id]),
        include_blank: "All Categories" %>

    <%= submit_tag "Search" %>
  </div>
<% end %>

<hr>

<!-- Product List -->
<% if @products.any? %>
  <% @products.each do |product| %>
    <div style="margin-bottom: 20px;">
      <h2><%= link_to product.name, product_path(product) %></h2>
      <p><strong>Category:</strong> <%= product.category.name %></p>
      <p><strong>Price:</strong> $<%= product.price %></p>
      <p><%= truncate(product.description, length: 120) %></p>
    </div>
    <hr>
  <% end %>

  <div class="pagination">
    <%= paginate @products %>
  </div>

<% else %>
  <p>No products found in this category.</p>
<% end %>
